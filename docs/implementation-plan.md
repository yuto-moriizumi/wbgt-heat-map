# 日最高WBGT値表示機能 実装計画

既存の機能を維持しつつ、新機能として「日最高のWGBT値表示」を追加する。

## 1. 方針

- **データソース**: 現在利用している月単位のWBGTデータCSV (`https://www.wbgt.env.go.jp/est15WG/dl/wbgt_all_${YYYYMM}.csv`) を引き続き利用する。日単位のデータを提供するURLの存在は不確かなため、既存リソースを活用し、クライアントサイドで日最高値を計算する。
- **UI**: タイムスライダーの近くに「日の最高値を表示」チェックボックスを設け、表示モードを切り替えられるようにする。
- **状態管理**: メインページ (`page.tsx`) で表示モード (`showDailyMax: boolean`) を管理し、各コンポーネントにPropsとして渡す。

## 2. 実装ステップ

### Step 1: データ処理ロジックの追加

- **ファイル**: `src/lib/fetch-wbgt-data.ts` (または新規ファイル)
- **タスク**:
    - 月単位のCSVデータ（文字列）と対象日を引数に取る関数を実装する。
    - この関数は、CSVデータを解析し、指定された日の各観測地点における最高WBGT値を計算して返す。
    - 戻り値の型は `WbgtData[]` または同様の構造とする。
- **ステータス**: ✅ 完了

### Step 2: UIコンポーネントの追加

- **ファイル**: `src/app/[locale]/page.tsx`
- **タスク**:
    - 表示モードを切り替えるためのUI（チェックボックスまたはスイッチ）を追加する。
    - このUIは、タイムスライダーコンポーネント (`TimeSlider`) の近くに配置する。
- **ステータス**: ✅ 完了

### Step 3: 多言語対応

- **ファイル**: `messages/en.json`, `messages/ja.json`
- **タスク**:
    - Step 2で追加したUIのラベルに対応する翻訳を追加する。
        - `en.json`: `"showDailyMax": "Show daily max WBGT"`
        - `ja.json`: `"showDailyMax": "日の最高値を表示"`
- **ステータス**: ✅ 完了

### Step 4: 状態管理と表示ロジックの統合

- **ファイル**: `src/app/[locale]/page.tsx`
- **タスク**:
    - 表示モードを管理するstate (`showDailyMax: boolean`) を追加する。
    - UI操作に応じて `showDailyMax` stateを更新する。
    - `showDailyMax` が `true` の場合、タイムスライダーを無効化または非表示にする。
    - `showDailyMax` の状態に応じて、`WbgtMap` に渡すデータを切り替える。
        - `true`: Step 1で実装した関数を使い、その日の最高値データを計算して渡す。
        - `false`: 従来通り、タイムスライダーで選択された時刻のデータを渡す。
- **ステータス**: ✅ 完了

### Step 5: 地図表示コンポーネントの更新

- **ファイル**: `src/components/WbgtMap.tsx`
- **タスク**:
    - `showDailyMax` が `true` の場合に渡される日最高値データを正しく解釈し、地図上に表示する。
    - ポップアップに表示される時刻の代わりに、「本日の最高値」のようなテキストを表示する。
- **ステータス**: ✅ 完了

## 3. テスト・検証項目

- [ ] 表示モードの切り替えがスムーズに行えるか。
- [ ] 「日の最高値を表示」モードで、各観測点のWBGT値がその日の最高値になっているか。
- [ ] モードを切り替えても、既存の時刻別表示機能が正しく動作するか（デグレード確認）。
- [ ] タイムスライダーの無効化/非表示が正しく制御されているか。
- [ ] 多言語表示が正しく切り替わるか。
