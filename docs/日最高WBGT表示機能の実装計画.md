# 日最高WBGT表示機能の実装計画

## 概要

現在のWBGTヒートマップ（最新または特定時刻の値を表示）に加え、各観測地点における「日最高WBGT」を日付ごとに確認できる機能を追加する。ユーザーは「リアルタイム表示」と「日最高WBGT表示」を切り替えることができ、それぞれのモードでスライダーを操作して時刻や日付を選択できるようになる。

## 実装方針

### 1. データ処理層の改修 (`src/lib/wbgt-data.ts`)

- `fetchWbgtData` 関数を大幅に改修し、**全期間のデータを処理**できるようにする。
- CSVから読み込んだ全データについて、観測地点と**日付ごと**にグループ化する。
- 各日付・各観測地点に対して、その日の最高WBGT値（`dailyMaxWbgt`）とその観測時刻（`dailyMaxWbgtTime`）を計算する。
- 関数が返すデータ構造を拡張し、以下の情報を含むようにする。
  - **リアルタイム用データ**: 最新日の時刻別WBGTデータ（既存の機能で利用）。
  - **日最高WBGT用データ**: 日付をキーとし、その日の日最高WBGT値を含むGeoJSONデータを値とするオブジェクト。
    - 例: `{ "2025-09-05": GeoJSON, "2025-09-04": GeoJSON, ... }`
  - **利用可能な日付リスト**: 日最高WBGTを表示できる日付の配列。

### 2. UI/状態管理層の改修 (`src/app/[locale]/page.tsx`)

- **表示モード切り替え機能**:
  - 「リアルタイム」と「日最高WBGT」を切り替えるUI（スイッチ等）を実装する。
  - 表示モードを管理する状態（`displayMode`）を追加する。
- **スライダーの動的制御**:
  - `displayMode` の状態に応じて `TimeSlider` コンポーネントに渡すプロパティを動的に変更する。
    - **リアルタイムモード時**: 最新日の**時刻リスト**を渡し、時刻選択スライダーとして機能させる。
    - **日最高WBGTモード時**: `fetchWbgtData` から取得した**日付リスト**を渡し、日付選択スライダーとして機能させる。
- **マップデータの動的制御**:
  - `displayMode` と `TimeSlider` から選択された値（時刻または日付）に基づいて、`WbgtMap` コンポーネントに表示させるGeoJSONデータを決定する。

### 3. コンポーネントの改修

- **`TimeSlider.tsx`**:
  - コンポーネントをより汎用的に改修する。
  - `labels` のようなプロパティで受け取った配列（時刻でも日付でも可）をスライダーの目盛りとして表示できるようにする。
- **`WbgtMapCore.tsx`**:
  - ポップアップの表示ロジックを `displayMode` に応じて変更する。
    - **リアルタイムモード**: 「WBGT: {値} ({時刻})」
    - **日最高WBGTモード**: 「日最高WBGT: {値} ({観測時刻})」
- **多言語対応 (`messages/*.json`)**:
  - 表示モード切り替えUIや新しいポップアップ表示に必要な文言（「リアルタイム」「日最高」など）を追加する。

## 作業ステップ

1.  `plan.md` を更新し、実装計画を合意する。（完了）
2.  `src/lib/wbgt-data.ts` の `fetchWbgtData` を改修し、全期間の日付別・日最高WBGTデータを生成するロジックを実装する。
3.  `src/components/TimeSlider.tsx` を改修し、任意のラベル配列を表示できる汎用的なコンポーネントにする。
4.  `messages/ja.json` と `messages/en.json` に必要な文言を追加する。
5.  `src/app/[locale]/page.tsx` に下記を実装する。
    - 表示モード切り替えUIと状態管理。
    - モードに応じて `TimeSlider` に渡すデータを切り替えるロジック。
    - モードとスライダーの値に応じて `WbgtMap` に渡すデータを切り替えるロジック。
6.  `src/components/WbgtMapCore.tsx` のポップアップ表示を、モードに応じて動的に更新するロジックを実装する。
7.  動作確認を行い、意図通りに表示と機能が切り替わることを確認する。
